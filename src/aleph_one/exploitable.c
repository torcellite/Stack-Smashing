#include <stdlib.h>
#include <string.h>

int i;
char *b_ptr;

/**
    exploit3.c and exploit4.c of the paper could not be performed on a
    64-bit system. The addresses are usually 6 bytes long and so the
    first two bytes are null.
    So, the shellcode from the exploit programs show junk after the 
    padded shellspawn hexcode instead of the predicted address of
    buffer.

    Required env variable EGG:
    ------------------------------------------------------------
    | Padded hexcode| Predicted address of buffer              |
    | x bytes       | buffer size of exploit program - x bytes |
    ------------------------------------------------------------

    Actual env variable EGG:
    ------------------------------------------------------------
    | Padded hexcode| Junk values                              |
    | x bytes       | buffer size of exploit program - x bytes |
    ------------------------------------------------------------
    
    If you know how to or have figured out how to fix this issue,
    mail me or perform a pull request.
**/

int main(int argc, char **argv) {

    char buffer[512];
    // This is displayed for exploit1.c
    printf("Buffer: %p\n", &buffer);
    // This is displayed for exploit2.c
    printf("Egg address: %p\n", getenv("EGG"));
    if (argc > 1) {
        /** 
            Go through overflow1.c to understand why strcpy is not used
        **/
        // strcpy(buffer, argv[1]);
        b_ptr = buffer;
        for (i = 0; i < 520; i++) {
            *(b_ptr++) = argv[1][i];
        }        
    }
    return 0;

}
